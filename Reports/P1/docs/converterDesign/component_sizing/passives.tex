\subsection{Passive components}  \label{passives}

To calculate the values of the passive components which includes the inductor, $C_{in}$ and $C_{out}$, a matlab  script has been created. This was done to see the different component values when frequency, number of mics and thereby different output voltages was used \todo{switching frequency, MICs, were used. Stef}. This also means that values for both buck and boost mode has been calculated \todo{different component values for... have been calculated. Stef}.

First of all the frequency was set to do a sweep from 20kH to 100kHz with steps of 10kHz. This was done because at this moment a switching frequency was not chosen yet, and in this way it was possible to see, how the passive components would change with different frequencies. 
The different output voltages was calculated by the voltage of the inverter $V_{inverter}=360V$ divided by the number of mics. Again for the number of mics a sweep was made starting with 4 mics and ending with 15 in steps of 1.

The maximum voltage from the PV panel is $V_{mpp}=32.6V$ \todo{is it? AT}
and to get the maximum current ohms law can be used, since the maximum power from the PV panel is 300W.

\begin{equation}
I_{mpp} = 300W/32.6V = 9.2A
\end{equation} 

From the $V_{mpp}$ and $I_{mpp}$ a constant K is calculated which will be an approximation of the relationship between the input voltage and input current.
By doing this the behaviour is seen as linear dependant.
\begin{equation}
 K = 32.6V/9.2A = 3.54
 \end{equation} 

The converter can operate in both buck and boost mode. The equations used to calculate the passive components for these modes is not the same ones. Therefore it is important to know which mode the converter will be in for a specific output voltage.  
The equations for the modes can be found in the appendix \ref{ch:Appbuckboost}. Here a value M is used which determines whether the voltage has to decrease or increase at the output. This value is calculated by:
\begin{equation}
M = V_{out}/V_{in}
\end{equation}
So a value smaller than one will need a decrease in voltage and therefore buck mode. On the other hand values bigger than one will need an increase in voltage which will be the boost mode. The exact value also tells how big an increase or decrease in voltage the converter needs to perform. \todo{This is not the only reason for M, also to obtain duties and understand the increase or decrease factor. AT}

All of this can be seen in the matlab script in the appendix folder \todo{Where will the script be??} 

The worst case values for the 3 components with variable frequency, number of mics and voltage could then be obtained from the script. 
In \ref{buckind} and \ref{boostind} the inductance L has been isolated and calculated with a current ripple of $10\%$ to get the different inductor values. For iteration 1 the frequency will be $50kHz$. Looking at the sheet the worst case will be in boost mode with $V_{out}=90V$ and $P=15W$. This is the minimum power which the mic will be working. If lower power could be obtained, the inductance would be higher. The inductance is calculated below:

\begin{equation}\label{buckind}
L = \frac{7.29V\cdot 0.919}{0.206A\cdot 50kHz} = 650\mu H
\end{equation} 

Where $7.29V$ is the input voltage at $15W$, $0.206A$ is the allowed ripple current, 50kHz the switching frequency and 0.919 is the dutycycle which has been calculated in this way:

\begin{equation} \label{boostD}
D = \frac{V_{out}-V_{in}}{V_{out}} = \frac{90V-7.29V}{90V} = 0.919
\end{equation} 

The capacitor values for the output is calculated in the same way by isolating the capacitance C in \ref{buckc} and \ref{boostc}. For the input capacitance equation \ref{buckcin} and \ref{boostcin} are used.
The $C_{in}$ and $C_{out}$ values is calculated with different voltage ripple percentages. For the output capacitor the allowed voltage ripple is set to $0.5\%$ while the input capacitors voltage ripple is even lower at $0.1\%$. \todo{why these values tho?, also for the rest of the components.AT}

For $C_{in}$ the worst case will be in buck mode with $V_{in}=32.6V$, $V_{out}=24V$ and $P=300W$ which is calculated below:

\begin{equation}
C_{in} = \frac{12.5A\cdot 0.736\cdot (1-0.736)}{0.033V\cdot 50kHz} = 1.49mF
\end{equation}    

Where $12.5A$ is the output current calculated below:

\begin{equation}
I_{out} = P/V_{out} = 300W/24V = 12.5A
\end{equation}

$0.033V$ is the allowed ripple voltage at the input, $50kHz$ the switching frequency and 0.736 the dutycycle which is calculated as below:

\begin{equation} \label{buckduty}
D = \frac{V_{out}}{V_{in}} = \frac{24V}{32.6V} = 0.736
\end{equation} 


The output capacitor worst case is also in buck mode but with $V_{out}=30V$ \todo{30V?Â¿?AT} instead. This is calculated by isolating the capacitance C in \ref{buckc}. \todo{WTF?}

\begin{equation} \label{buckc} 
C_{out} = \frac{32.6V}{8\cdot 48\mu H*50kHz^2\cdot 0.15V} = 16.718\mu F
\end{equation}

where $32.6V$ is the input voltage, $50kHz$ is the switching frequency, $0.15V$ the allowed ripple voltage at the output and $48\mu H$ is the inductance. This is inductance is calculated at worst case. 
Since the converter is not working in worst case and the inductor is bigger, a much lower ripple voltage than the 0.15V will be obtained. As seen in the next section the actual output capacitor is $820\mu F$ which will give a ripple voltage as below:

\begin{equation} \label{buckc} 
\Delta V_o = \frac{32.6V}{8\cdot 650\mu H*50kHz^2\cdot 820\mu F} = 0.003V
\end{equation}
\todo{even lower because the actual inductor is bigger as well. JK}  
   

\subsubsection{Selection of passive components}
For the output capacitor a $820\mu F$ has been used \cite{cout}. An electrolytic capacitor has mostly been chosen because of small size and low cost. The voltage rating is 250V which is a fine margin to the 90V that is the highest possible output. \todo{with max 90V a much lower voltage rating could have been chosen! margin is again not the reason for this value, true that maybe we did oversize it when designing. AT} \todo{well not saying that the margin is the reason. Just mentioning it. Can't see that is a problem? JK}
Achieving the necessary input capacitance with only one capacitor would result in very big size of the component, therefore four electrolytic capacitors of $470\mu F$ \cite{cin} are placed in parallel to get a summed capacitance of $1.880\mu F$. The rating for these is 100V which has been chosen in case the output is connected to the input by accident. In this case that will not ruin the input capacitor. These ESR resistances will be about $0.047\Omega$. Both input and output capacitor have a capacitance higher than the calculated worst case. This is because the converter maybe in the future will have a buck-boost mode as well. And in this mode the capacitance can get a bit higher. \todo{I think this is not the best way to introduce the buck boost possibil<ity. AT}
Both for the input and output a $100nF$ and a $1\mu F$ capacitors are placed in parallel. This is mostly done because the big electrolytic capacitors is not able to supply the needed current at higher frequencies. With these extra capacitors the high frequency transients should be filtered away.

The inductor for first iteration \todo{What does first iteration mean? have we explained it previously? AT} will be with an inductance of around 1mH, \todo{exact value should be determined JK} because that is an inductor the supervisors had in-house already.